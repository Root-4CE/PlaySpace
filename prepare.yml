---
  - name: Preparing
    hosts: all
    become: yes

    tasks:

      - name: create user ansible
        user:
          name: ansible
          password: 123qwe
          shell: /sbin/nologin
          home: /ansible/
          remove: true

      - name: create user ansible
        user:
          name: supervisor
          state: present

      - name: upload ssh keys
        authorized_key:
          user: supervisor
          state: present
          key: "{{ lookup('file', '/home/supervisor/.ssh/id_rsa.pub') }}"

      - name: change sudoers
        lineinfile:
          path: /etc/sudoers.d/supervisor
          line: 'supervisor ALL=(ALL:ALL) NOPASSWD:ALL'
          state: present