---
  - name: Preparing
    hosts: all
    #become: yes
    #become_method: sudo
    #become_user: supervisor

    tasks:
          
      - name: create user ansible
        user:
          name: ansible
          password: 123qwe
          groups: sudo
          shell: /sbin/nologin
          home: /ansible
          state: present

      - name: upload ssh keys
        authorized_key:
          user: ansible
          state: present
          key: "{{ lookup('file', '/home/supervisor/.ssh/id_rsa.pub') }}"

      - name: change sudoers
        lineinfile:
          path: /etc/sudoers.d/ansible
          line: 'ansible ALL=(ALL:ALL) NOPASSWD:ALL'
          #state: present
          create: yes