---
  - name: Preparing
    hosts: all
    become: yes

    tasks:
          
      - name: create user ansible
        user:
          name: ansible
          password: 123qwe
          shell: /sbin/nologin
          home: /ansible/
          state: present

      - name: upload ssh keys
        authorized_key:
          user: ansible
          state: present
          key: "{{ lookup('file', '/ansible/.ssh/id_rsa.pub') }}"

      - name: change sudoers
        lineinfile:
          path: /etc/sudoers.d/ansible
          line: 'ansible ALL=(ALL:ALL) NOPASSWD:ALL'
          state: present